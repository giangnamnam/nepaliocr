<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OCR: myWindow.h Source File</title>
<link href="ocr.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Created By Rajesh Pandey   -->
<h1>myWindow.h</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include "Separate.h"</span>
00002 <span class="preprocessor">#include "Line.h"</span>
00003 <span class="preprocessor">#include "ThresholedValue.h"</span>
00004 <span class="preprocessor">#include "rgbConvert.h"</span>
00005 <span class="preprocessor">#include "RecognitionForm.h"</span>
00006 <span class="preprocessor">#include "RecognitionProcess.h"</span>
00007 
00008 <span class="preprocessor">#pragma once</span>
00009 <span class="preprocessor"></span>
00010 <span class="keyword">using</span> <span class="keyword">namespace </span>System;
00011 <span class="keyword">using</span> <span class="keyword">namespace </span>System::ComponentModel;
00012 <span class="keyword">using</span> <span class="keyword">namespace </span>System::Collections;
00013 <span class="keyword">using</span> <span class="keyword">namespace </span>System::Windows::Forms;
00014 <span class="keyword">using</span> <span class="keyword">namespace </span>System::Data;
00015 <span class="keyword">using</span> <span class="keyword">namespace </span>System::Drawing;
00016 
00017 
00018 <span class="keyword">namespace </span>OCR
00019 {
<a name="l00029"></a><a class="code" href="classOCR_1_1myWindow.html">00029</a>     <span class="keyword">public</span> __gc <span class="keyword">class </span><a class="code" href="classOCR_1_1myWindow.html">myWindow</a> : <span class="keyword">public</span> System::Windows::Forms::Form
00030     {
00031     <span class="keyword">public</span>: 
00032         <a class="code" href="classOCR_1_1myWindow.html">myWindow</a>(
00033                         Bitmap* im,
00034                         Bitmap* BinaryImage,
00035                         Graphics* g,
00036                         <span class="keywordtype">int</span> intLevel,
00037                         <span class="keywordtype">int</span> **ImgArray,
00038                         <span class="keywordtype">bool</span> **BArray,
00039                         <span class="keywordtype">bool</span> **tmpBArray,
00040                         <span class="keywordtype">bool</span> BinaryDone,
00041                         <span class="keywordtype">bool</span> ImageLoaded,
00042                         <span class="keywordtype">bool</span> SeparateDone,
00043                         <span class="keywordtype">bool</span> ContrastDone,
00044                         <span class="keywordtype">bool</span> meanDone,
00045                         <span class="keywordtype">bool</span> deskewDone,
00046                         <span class="keywordtype">int</span> numberOfLines,
00047                         Line* Lines, 
00048                         String* applicationPath,
00049                         String* modelTrainDBPath,
00050                         String* scriptFilePath,
00051                         String* characterDBPath,
00052                         System::Collections::SortedList* slForCharacters,
00053                         System::Collections::SortedList* slModelTranscription,  <span class="comment">// for storing the model transcriptions</span>
00054                         System::Collections::ArrayList* alModelRec
00055                         
00056     ){
00057 
00058             InitializeComponent();
00059             this-&gt;im = im;
00060             this-&gt;BinaryImage = BinaryImage;
00061             this-&gt;g =g;
00062             this-&gt;intLevel=intLevel;
00063             this-&gt;ImgArray=ImgArray;
00064             this-&gt;BArray=BArray;
00065             this-&gt;tmpBArray=tmpBArray;
00066             this-&gt;BinaryDone=BinaryDone;
00067             this-&gt;ImageLoaded=ImageLoaded;
00068             this-&gt;SeparateDone=SeparateDone;
00069             this-&gt;ContrastDone=ContrastDone;
00070             this-&gt;meanDone=meanDone;
00071             this-&gt;deskewDone=deskewDone;
00072             this-&gt;numberOfLines=numberOfLines;
00073             this-&gt;Lines=Lines;
00074             this-&gt;applicationPath=applicationPath;
00075             this-&gt;modelTrainDBPath=modelTrainDBPath;
00076             this-&gt;scriptFilePath=scriptFilePath;
00077             this-&gt;characterDBPath=characterDBPath;
00078             this-&gt;slForCharacters=slForCharacters;
00079             this-&gt;slModelTranscription=slModelTranscription;    <span class="comment">// for storing the model transcriptions</span>
00080             this-&gt;alModelRec=alModelRec;
00081             this-&gt;pictureBox_myWindow-&gt;Image = this-&gt;im;
00082             this-&gt;bigHeightLabel-&gt;Text = this-&gt;im-&gt;Height.ToString();
00083             this-&gt;bigWidthLabel-&gt;Text = this-&gt;im-&gt;Width.ToString();
00084             
00085 
00086 
00087 
00088             
00089             <span class="comment">//application path</span>
00090             this-&gt;applicationPath=Application::StartupPath-&gt;ToString();
00091             <span class="keywordtype">int</span> len = this-&gt;applicationPath-&gt;Length -1;         
00092             <span class="keywordflow">if</span>(this-&gt;applicationPath-&gt;Substring(len)-&gt;Equals(<span class="stringliteral">"\\"</span>))
00093             {
00094                 this-&gt;applicationPath = this-&gt;applicationPath-&gt;Substring(0,len);                
00095             }
00096             
00097             this-&gt;modelTrainDBPath = this-&gt;modelTrainDBPath-&gt;Concat(this-&gt;applicationPath , <span class="stringliteral">"\\htk\\DataBaseFile\\modelTrainDataBase.txt"</span>);
00098             
00099             this-&gt;alModelRec = <span class="keyword">new</span> System::Collections::ArrayList();
00100             this-&gt;characterDBPath=this-&gt;characterDBPath-&gt;Concat(this-&gt;applicationPath ,<span class="stringliteral">"\\htk\\DataBaseFile\\characters.txt"</span>);  
00101             this-&gt;scriptFilePath = this-&gt;scriptFilePath-&gt;Concat(this-&gt;applicationPath ,<span class="stringliteral">"\\htk\\recognizer\\script.txt"</span>);
00102             this-&gt;LoadFromFile();
00103 
00104 
00105         }
00106         
00107     <span class="keyword">protected</span>: 
00108         <span class="keywordtype">void</span> Dispose(Boolean disposing)
00109         {
00110             <span class="keywordflow">if</span> (disposing &amp;&amp; components)
00111             {
00112                 components-&gt;Dispose();
00113             }
00114             __super::Dispose(disposing);
00115         }
00116     <span class="keyword">private</span>: System::Windows::Forms::Panel *  panel1;
00117     <span class="keyword">private</span>: System::Windows::Forms::SaveFileDialog *  saveFileDialog_Image_Viewer;
00118     <span class="keyword">private</span>: System::Windows::Forms::Button *  saveButton_ImageViewer_Form;
00119     <span class="keyword">private</span>: System::Windows::Forms::Button *  singleRecog;
00120     <span class="keyword">private</span>: System::Windows::Forms::GroupBox *  groupBox1;
00121     <span class="keyword">private</span>: System::Windows::Forms::GroupBox *  groupBox2;
00122     <span class="keyword">private</span>: System::Windows::Forms::GroupBox *  groupBox3;
00123     <span class="keyword">private</span>: System::Windows::Forms::PictureBox *  pictureBox_myWindow;
00124     <span class="keyword">private</span>: System::Windows::Forms::Button *  myWindowRecognizeButton;
00125     <span class="keyword">private</span>: System::Windows::Forms::Button *  myWindowSeparateButton;
00126     <span class="keyword">private</span>: System::Windows::Forms::RichTextBox *  myRTB;
00127     <span class="keyword">private</span>: System::Windows::Forms::PictureBox *  pictureBoxSmall;
00128     <span class="keyword">private</span>: System::Windows::Forms::Label *  label1;
00129     <span class="keyword">private</span>: System::Windows::Forms::Label *  bigHeightLabel;
00130     <span class="keyword">private</span>: System::Windows::Forms::Label *  label2;
00131     <span class="keyword">private</span>: System::Windows::Forms::Label *  bigWidthLabel;
00132     <span class="keyword">private</span>: System::Windows::Forms::Label *  label4;
00133     <span class="keyword">private</span>: System::Windows::Forms::Label *  smallHeightLabel;
00134     <span class="keyword">private</span>: System::Windows::Forms::Label *  smallWidthLabel;
00135     <span class="keyword">private</span>: System::Windows::Forms::Label *  label3;
00136     <span class="keyword">private</span>: System::Windows::Forms::Button *  nextButton;
00137     <span class="keyword">private</span>: System::Windows::Forms::Button *  exitButton;
00138     <span class="keyword">private</span>: System::Windows::Forms::Label *  label5;
00139     <span class="keyword">private</span>: System::Windows::Forms::Label *  avgWidthLabel;
00140     <span class="keyword">private</span>: System::Windows::Forms::Label *  label6;
00141     <span class="keyword">private</span>: System::Windows::Forms::Label *  avgHeightLabel;
00142 
00143     <span class="keyword">private</span>: Bitmap* im;
00144     <span class="keyword">private</span>: Bitmap* BinaryImage;
00145 
00146     <span class="keywordtype">bool</span>** BinArray;
00147 
00148     <span class="keyword">private</span>: Graphics* g;
00149     <span class="keyword">private</span>: <span class="keywordtype">int</span> intLevel;
00150     <span class="keyword">private</span>: <span class="keywordtype">int</span> **ImgArray;
00151 
00152     <span class="keywordtype">int</span> **ImageArray;
00153 
00154     <span class="keyword">private</span>: <span class="keywordtype">bool</span> **BArray;
00155              <span class="keywordtype">bool</span> **tmpBArray;
00156     <span class="keyword">private</span>: <span class="keywordtype">bool</span> BinaryDone;
00157     <span class="keyword">private</span>: <span class="keywordtype">bool</span> ImageLoaded;
00158              <span class="keywordtype">bool</span> SeparateDone;
00159              <span class="keywordtype">bool</span> ContrastDone;
00160              <span class="keywordtype">bool</span> meanDone;
00161              <span class="keywordtype">bool</span> deskewDone;
00162 
00163 
00164     <span class="keyword">private</span>: <span class="keywordtype">int</span> numberOfLines;
00165     <span class="keyword">private</span>: Line* Lines; 
00166 
00167     <span class="keyword">private</span>: String* applicationPath;
00168              String* modelTrainDBPath;
00169              String* scriptFilePath;
00170              String* characterDBPath;
00171 
00172     
00173     <span class="keyword">private</span>: System::Collections::SortedList* slForCharacters;
00174     <span class="keyword">private</span>: System::Collections::SortedList* slModelTranscription; <span class="comment">// for storing the model transcriptions</span>
00175     <span class="keyword">private</span>: System::Collections::ArrayList* alModelRec;            <span class="comment">// for models that already recognized</span>
00176 
00177     Line* LineInfo;
00178     <span class="keywordtype">int</span> lineCount;
00179     <span class="keyword">static</span> <span class="keywordtype">int</span> lineno=0;
00180     <span class="keyword">static</span> <span class="keywordtype">int</span> wordno=0;
00181     <span class="keyword">static</span> <span class="keywordtype">int</span> charno=0;
00182     <span class="keyword">private</span>: <span class="keywordtype">int</span> x1,x2,y1,y2;
00183     Bitmap* cropImage;
00184     
00185         
00186     <span class="keyword">private</span>:
00190         System::ComponentModel::Container* components;
00191 
00196         <span class="keywordtype">void</span> InitializeComponent(<span class="keywordtype">void</span>)
00197         {
00198             System::Resources::ResourceManager *  resources = <span class="keyword">new</span> System::Resources::ResourceManager(__typeof(<a class="code" href="classOCR_1_1myWindow.html">OCR::myWindow</a>));
00199             this-&gt;panel1 = <span class="keyword">new</span> System::Windows::Forms::Panel();
00200             this-&gt;pictureBox_myWindow = <span class="keyword">new</span> System::Windows::Forms::PictureBox();
00201             this-&gt;groupBox1 = <span class="keyword">new</span> System::Windows::Forms::GroupBox();
00202             this-&gt;bigWidthLabel = <span class="keyword">new</span> System::Windows::Forms::Label();
00203             this-&gt;label2 = <span class="keyword">new</span> System::Windows::Forms::Label();
00204             this-&gt;bigHeightLabel = <span class="keyword">new</span> System::Windows::Forms::Label();
00205             this-&gt;label1 = <span class="keyword">new</span> System::Windows::Forms::Label();
00206             this-&gt;groupBox2 = <span class="keyword">new</span> System::Windows::Forms::GroupBox();
00207             this-&gt;saveButton_ImageViewer_Form = <span class="keyword">new</span> System::Windows::Forms::Button();
00208             this-&gt;singleRecog = <span class="keyword">new</span> System::Windows::Forms::Button();
00209             this-&gt;myWindowRecognizeButton = <span class="keyword">new</span> System::Windows::Forms::Button();
00210             this-&gt;myWindowSeparateButton = <span class="keyword">new</span> System::Windows::Forms::Button();
00211             this-&gt;avgHeightLabel = <span class="keyword">new</span> System::Windows::Forms::Label();
00212             this-&gt;label6 = <span class="keyword">new</span> System::Windows::Forms::Label();
00213             this-&gt;avgWidthLabel = <span class="keyword">new</span> System::Windows::Forms::Label();
00214             this-&gt;label5 = <span class="keyword">new</span> System::Windows::Forms::Label();
00215             this-&gt;exitButton = <span class="keyword">new</span> System::Windows::Forms::Button();
00216             this-&gt;nextButton = <span class="keyword">new</span> System::Windows::Forms::Button();
00217             this-&gt;label3 = <span class="keyword">new</span> System::Windows::Forms::Label();
00218             this-&gt;smallWidthLabel = <span class="keyword">new</span> System::Windows::Forms::Label();
00219             this-&gt;smallHeightLabel = <span class="keyword">new</span> System::Windows::Forms::Label();
00220             this-&gt;label4 = <span class="keyword">new</span> System::Windows::Forms::Label();
00221             this-&gt;pictureBoxSmall = <span class="keyword">new</span> System::Windows::Forms::PictureBox();
00222             this-&gt;groupBox3 = <span class="keyword">new</span> System::Windows::Forms::GroupBox();
00223             this-&gt;myRTB = <span class="keyword">new</span> System::Windows::Forms::RichTextBox();
00224             this-&gt;saveFileDialog_Image_Viewer = <span class="keyword">new</span> System::Windows::Forms::SaveFileDialog();
00225             this-&gt;panel1-&gt;SuspendLayout();
00226             this-&gt;groupBox1-&gt;SuspendLayout();
00227             this-&gt;groupBox2-&gt;SuspendLayout();
00228             this-&gt;groupBox3-&gt;SuspendLayout();
00229             this-&gt;SuspendLayout();
00230             <span class="comment">// </span>
00231             <span class="comment">// panel1</span>
00232             <span class="comment">// </span>
00233             this-&gt;panel1-&gt;AutoScroll = <span class="keyword">true</span>;
00234             this-&gt;panel1-&gt;Controls-&gt;Add(this-&gt;pictureBox_myWindow);
00235             this-&gt;panel1-&gt;Location = System::Drawing::Point(8, 80);
00236             this-&gt;panel1-&gt;Name = S<span class="stringliteral">"panel1"</span>;
00237             this-&gt;panel1-&gt;Size = System::Drawing::Size(312, 360);
00238             this-&gt;panel1-&gt;TabIndex = 0;
00239             <span class="comment">// </span>
00240             <span class="comment">// pictureBox_myWindow</span>
00241             <span class="comment">// </span>
00242             this-&gt;pictureBox_myWindow-&gt;Location = System::Drawing::Point(56, 32);
00243             this-&gt;pictureBox_myWindow-&gt;Name = S<span class="stringliteral">"pictureBox_myWindow"</span>;
00244             this-&gt;pictureBox_myWindow-&gt;SizeMode = System::Windows::Forms::PictureBoxSizeMode::AutoSize;
00245             this-&gt;pictureBox_myWindow-&gt;TabIndex = 0;
00246             this-&gt;pictureBox_myWindow-&gt;TabStop = <span class="keyword">false</span>;
00247             <span class="comment">// </span>
00248             <span class="comment">// groupBox1</span>
00249             <span class="comment">// </span>
00250             this-&gt;groupBox1-&gt;Controls-&gt;Add(this-&gt;bigWidthLabel);
00251             this-&gt;groupBox1-&gt;Controls-&gt;Add(this-&gt;label2);
00252             this-&gt;groupBox1-&gt;Controls-&gt;Add(this-&gt;bigHeightLabel);
00253             this-&gt;groupBox1-&gt;Controls-&gt;Add(this-&gt;label1);
00254             this-&gt;groupBox1-&gt;Controls-&gt;Add(this-&gt;panel1);
00255             this-&gt;groupBox1-&gt;Location = System::Drawing::Point(24, 24);
00256             this-&gt;groupBox1-&gt;Name = S<span class="stringliteral">"groupBox1"</span>;
00257             this-&gt;groupBox1-&gt;Size = System::Drawing::Size(336, 448);
00258             this-&gt;groupBox1-&gt;TabIndex = 0;
00259             this-&gt;groupBox1-&gt;TabStop = <span class="keyword">false</span>;
00260             this-&gt;groupBox1-&gt;Text = S<span class="stringliteral">"Input Image"</span>;
00261             <span class="comment">// </span>
00262             <span class="comment">// bigWidthLabel</span>
00263             <span class="comment">// </span>
00264             this-&gt;bigWidthLabel-&gt;Location = System::Drawing::Point(136, 48);
00265             this-&gt;bigWidthLabel-&gt;Name = S<span class="stringliteral">"bigWidthLabel"</span>;
00266             this-&gt;bigWidthLabel-&gt;Size = System::Drawing::Size(120, 24);
00267             this-&gt;bigWidthLabel-&gt;TabIndex = 4;
00268             <span class="comment">// </span>
00269             <span class="comment">// label2</span>
00270             <span class="comment">// </span>
00271             this-&gt;label2-&gt;Location = System::Drawing::Point(24, 48);
00272             this-&gt;label2-&gt;Name = S<span class="stringliteral">"label2"</span>;
00273             this-&gt;label2-&gt;Size = System::Drawing::Size(88, 24);
00274             this-&gt;label2-&gt;TabIndex = 3;
00275             this-&gt;label2-&gt;Text = S<span class="stringliteral">"Image Width"</span>;
00276             <span class="comment">// </span>
00277             <span class="comment">// bigHeightLabel</span>
00278             <span class="comment">// </span>
00279             this-&gt;bigHeightLabel-&gt;Location = System::Drawing::Point(136, 24);
00280             this-&gt;bigHeightLabel-&gt;Name = S<span class="stringliteral">"bigHeightLabel"</span>;
00281             this-&gt;bigHeightLabel-&gt;Size = System::Drawing::Size(120, 16);
00282             this-&gt;bigHeightLabel-&gt;TabIndex = 2;
00283             <span class="comment">// </span>
00284             <span class="comment">// label1</span>
00285             <span class="comment">// </span>
00286             this-&gt;label1-&gt;Location = System::Drawing::Point(24, 24);
00287             this-&gt;label1-&gt;Name = S<span class="stringliteral">"label1"</span>;
00288             this-&gt;label1-&gt;Size = System::Drawing::Size(96, 24);
00289             this-&gt;label1-&gt;TabIndex = 1;
00290             this-&gt;label1-&gt;Text = S<span class="stringliteral">"Image Height"</span>;
00291             <span class="comment">// </span>
00292             <span class="comment">// groupBox2</span>
00293             <span class="comment">// </span>
00294             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;saveButton_ImageViewer_Form);
00295             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;singleRecog);
00296             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;myWindowRecognizeButton);
00297             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;myWindowSeparateButton);
00298             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;avgHeightLabel);
00299             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;label6);
00300             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;avgWidthLabel);
00301             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;label5);
00302             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;exitButton);
00303             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;nextButton);
00304             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;label3);
00305             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;smallWidthLabel);
00306             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;smallHeightLabel);
00307             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;label4);
00308             this-&gt;groupBox2-&gt;Controls-&gt;Add(this-&gt;pictureBoxSmall);
00309             this-&gt;groupBox2-&gt;Location = System::Drawing::Point(368, 32);
00310             this-&gt;groupBox2-&gt;Name = S<span class="stringliteral">"groupBox2"</span>;
00311             this-&gt;groupBox2-&gt;Size = System::Drawing::Size(280, 448);
00312             this-&gt;groupBox2-&gt;TabIndex = 1;
00313             this-&gt;groupBox2-&gt;TabStop = <span class="keyword">false</span>;
00314             this-&gt;groupBox2-&gt;Text = S<span class="stringliteral">"Sliced Single Image"</span>;
00315             <span class="comment">// </span>
00316             <span class="comment">// saveButton_ImageViewer_Form</span>
00317             <span class="comment">// </span>
00318             this-&gt;saveButton_ImageViewer_Form-&gt;Location = System::Drawing::Point(40, 256);
00319             this-&gt;saveButton_ImageViewer_Form-&gt;Name = S<span class="stringliteral">"saveButton_ImageViewer_Form"</span>;
00320             this-&gt;saveButton_ImageViewer_Form-&gt;Size = System::Drawing::Size(72, 24);
00321             this-&gt;saveButton_ImageViewer_Form-&gt;TabIndex = 14;
00322             this-&gt;saveButton_ImageViewer_Form-&gt;Text = S<span class="stringliteral">"Save"</span>;
00323             this-&gt;saveButton_ImageViewer_Form-&gt;Click += <span class="keyword">new</span> System::EventHandler(<span class="keyword">this</span>, saveButton_ImageViewer_Form_Click);
00324             <span class="comment">// </span>
00325             <span class="comment">// singleRecog</span>
00326             <span class="comment">// </span>
00327             this-&gt;singleRecog-&gt;Location = System::Drawing::Point(160, 304);
00328             this-&gt;singleRecog-&gt;Name = S<span class="stringliteral">"singleRecog"</span>;
00329             this-&gt;singleRecog-&gt;Size = System::Drawing::Size(88, 24);
00330             this-&gt;singleRecog-&gt;TabIndex = 13;
00331             this-&gt;singleRecog-&gt;Text = S<span class="stringliteral">"Single Recog"</span>;
00332             this-&gt;singleRecog-&gt;Click += <span class="keyword">new</span> System::EventHandler(<span class="keyword">this</span>, singleRecog_Click);
00333             <span class="comment">// </span>
00334             <span class="comment">// myWindowRecognizeButton</span>
00335             <span class="comment">// </span>
00336             this-&gt;myWindowRecognizeButton-&gt;Location = System::Drawing::Point(152, 272);
00337             this-&gt;myWindowRecognizeButton-&gt;Name = S<span class="stringliteral">"myWindowRecognizeButton"</span>;
00338             this-&gt;myWindowRecognizeButton-&gt;Size = System::Drawing::Size(80, 24);
00339             this-&gt;myWindowRecognizeButton-&gt;TabIndex = 12;
00340             this-&gt;myWindowRecognizeButton-&gt;Text = S<span class="stringliteral">"RecognizeAll"</span>;
00341             this-&gt;myWindowRecognizeButton-&gt;Click += <span class="keyword">new</span> System::EventHandler(<span class="keyword">this</span>, myWindowRecognizeButton_Click);
00342             <span class="comment">// </span>
00343             <span class="comment">// myWindowSeparateButton</span>
00344             <span class="comment">// </span>
00345             this-&gt;myWindowSeparateButton-&gt;Location = System::Drawing::Point(48, 296);
00346             this-&gt;myWindowSeparateButton-&gt;Name = S<span class="stringliteral">"myWindowSeparateButton"</span>;
00347             this-&gt;myWindowSeparateButton-&gt;Size = System::Drawing::Size(72, 48);
00348             this-&gt;myWindowSeparateButton-&gt;TabIndex = 11;
00349             this-&gt;myWindowSeparateButton-&gt;Text = S<span class="stringliteral">"Separate"</span>;
00350             this-&gt;myWindowSeparateButton-&gt;Click += <span class="keyword">new</span> System::EventHandler(<span class="keyword">this</span>, myWindowSeparateButton_Click);
00351             <span class="comment">// </span>
00352             <span class="comment">// avgHeightLabel</span>
00353             <span class="comment">// </span>
00354             this-&gt;avgHeightLabel-&gt;Location = System::Drawing::Point(120, 112);
00355             this-&gt;avgHeightLabel-&gt;Name = S<span class="stringliteral">"avgHeightLabel"</span>;
00356             this-&gt;avgHeightLabel-&gt;Size = System::Drawing::Size(128, 24);
00357             this-&gt;avgHeightLabel-&gt;TabIndex = 10;
00358             <span class="comment">// </span>
00359             <span class="comment">// label6</span>
00360             <span class="comment">// </span>
00361             this-&gt;label6-&gt;Location = System::Drawing::Point(17, 112);
00362             this-&gt;label6-&gt;Name = S<span class="stringliteral">"label6"</span>;
00363             this-&gt;label6-&gt;Size = System::Drawing::Size(88, 24);
00364             this-&gt;label6-&gt;TabIndex = 9;
00365             this-&gt;label6-&gt;Text = S<span class="stringliteral">"Average Height"</span>;
00366             <span class="comment">// </span>
00367             <span class="comment">// avgWidthLabel</span>
00368             <span class="comment">// </span>
00369             this-&gt;avgWidthLabel-&gt;Location = System::Drawing::Point(120, 88);
00370             this-&gt;avgWidthLabel-&gt;Name = S<span class="stringliteral">"avgWidthLabel"</span>;
00371             this-&gt;avgWidthLabel-&gt;Size = System::Drawing::Size(128, 24);
00372             this-&gt;avgWidthLabel-&gt;TabIndex = 8;
00373             <span class="comment">// </span>
00374             <span class="comment">// label5</span>
00375             <span class="comment">// </span>
00376             this-&gt;label5-&gt;Location = System::Drawing::Point(16, 88);
00377             this-&gt;label5-&gt;Name = S<span class="stringliteral">"label5"</span>;
00378             this-&gt;label5-&gt;Size = System::Drawing::Size(80, 24);
00379             this-&gt;label5-&gt;TabIndex = 7;
00380             this-&gt;label5-&gt;Text = S<span class="stringliteral">"Average width"</span>;
00381             <span class="comment">// </span>
00382             <span class="comment">// exitButton</span>
00383             <span class="comment">// </span>
00384             this-&gt;exitButton-&gt;Location = System::Drawing::Point(152, 344);
00385             this-&gt;exitButton-&gt;Name = S<span class="stringliteral">"exitButton"</span>;
00386             this-&gt;exitButton-&gt;Size = System::Drawing::Size(112, 72);
00387             this-&gt;exitButton-&gt;TabIndex = 6;
00388             this-&gt;exitButton-&gt;Text = S<span class="stringliteral">"Exit"</span>;
00389             this-&gt;exitButton-&gt;Click += <span class="keyword">new</span> System::EventHandler(<span class="keyword">this</span>, exitButton_Click);
00390             <span class="comment">// </span>
00391             <span class="comment">// nextButton</span>
00392             <span class="comment">// </span>
00393             this-&gt;nextButton-&gt;Location = System::Drawing::Point(48, 360);
00394             this-&gt;nextButton-&gt;Name = S<span class="stringliteral">"nextButton"</span>;
00395             this-&gt;nextButton-&gt;Size = System::Drawing::Size(72, 48);
00396             this-&gt;nextButton-&gt;TabIndex = 5;
00397             this-&gt;nextButton-&gt;Text = S<span class="stringliteral">"Next"</span>;
00398             this-&gt;nextButton-&gt;Click += <span class="keyword">new</span> System::EventHandler(<span class="keyword">this</span>, nextButton_Click);
00399             <span class="comment">// </span>
00400             <span class="comment">// label3</span>
00401             <span class="comment">// </span>
00402             this-&gt;label3-&gt;Location = System::Drawing::Point(34, 56);
00403             this-&gt;label3-&gt;Name = S<span class="stringliteral">"label3"</span>;
00404             this-&gt;label3-&gt;Size = System::Drawing::Size(56, 16);
00405             this-&gt;label3-&gt;TabIndex = 4;
00406             this-&gt;label3-&gt;Text = S<span class="stringliteral">"Width"</span>;
00407             <span class="comment">// </span>
00408             <span class="comment">// smallWidthLabel</span>
00409             <span class="comment">// </span>
00410             this-&gt;smallWidthLabel-&gt;Location = System::Drawing::Point(120, 56);
00411             this-&gt;smallWidthLabel-&gt;Name = S<span class="stringliteral">"smallWidthLabel"</span>;
00412             this-&gt;smallWidthLabel-&gt;Size = System::Drawing::Size(128, 16);
00413             this-&gt;smallWidthLabel-&gt;TabIndex = 3;
00414             <span class="comment">// </span>
00415             <span class="comment">// smallHeightLabel</span>
00416             <span class="comment">// </span>
00417             this-&gt;smallHeightLabel-&gt;Location = System::Drawing::Point(120, 24);
00418             this-&gt;smallHeightLabel-&gt;Name = S<span class="stringliteral">"smallHeightLabel"</span>;
00419             this-&gt;smallHeightLabel-&gt;Size = System::Drawing::Size(120, 16);
00420             this-&gt;smallHeightLabel-&gt;TabIndex = 2;
00421             <span class="comment">// </span>
00422             <span class="comment">// label4</span>
00423             <span class="comment">// </span>
00424             this-&gt;label4-&gt;Location = System::Drawing::Point(32, 24);
00425             this-&gt;label4-&gt;Name = S<span class="stringliteral">"label4"</span>;
00426             this-&gt;label4-&gt;Size = System::Drawing::Size(56, 16);
00427             this-&gt;label4-&gt;TabIndex = 1;
00428             this-&gt;label4-&gt;Text = S<span class="stringliteral">"Height"</span>;
00429             <span class="comment">// </span>
00430             <span class="comment">// pictureBoxSmall</span>
00431             <span class="comment">// </span>
00432             this-&gt;pictureBoxSmall-&gt;Location = System::Drawing::Point(80, 176);
00433             this-&gt;pictureBoxSmall-&gt;Name = S<span class="stringliteral">"pictureBoxSmall"</span>;
00434             this-&gt;pictureBoxSmall-&gt;TabIndex = 0;
00435             this-&gt;pictureBoxSmall-&gt;TabStop = <span class="keyword">false</span>;
00436             <span class="comment">// </span>
00437             <span class="comment">// groupBox3</span>
00438             <span class="comment">// </span>
00439             this-&gt;groupBox3-&gt;Controls-&gt;Add(this-&gt;myRTB);
00440             this-&gt;groupBox3-&gt;Location = System::Drawing::Point(656, 32);
00441             this-&gt;groupBox3-&gt;Name = S<span class="stringliteral">"groupBox3"</span>;
00442             this-&gt;groupBox3-&gt;Size = System::Drawing::Size(240, 448);
00443             this-&gt;groupBox3-&gt;TabIndex = 2;
00444             this-&gt;groupBox3-&gt;TabStop = <span class="keyword">false</span>;
00445             this-&gt;groupBox3-&gt;Text = S<span class="stringliteral">"Logs"</span>;
00446             <span class="comment">// </span>
00447             <span class="comment">// myRTB</span>
00448             <span class="comment">// </span>
00449             this-&gt;myRTB-&gt;Location = System::Drawing::Point(16, 40);
00450             this-&gt;myRTB-&gt;Name = S<span class="stringliteral">"myRTB"</span>;
00451             this-&gt;myRTB-&gt;Size = System::Drawing::Size(208, 392);
00452             this-&gt;myRTB-&gt;TabIndex = 0;
00453             this-&gt;myRTB-&gt;Text = S<span class="stringliteral">""</span>;
00454             <span class="comment">// </span>
00455             <span class="comment">// myWindow</span>
00456             <span class="comment">// </span>
00457             this-&gt;AllowDrop = <span class="keyword">true</span>;
00458             this-&gt;AutoScaleBaseSize = System::Drawing::Size(5, 13);
00459             this-&gt;ClientSize = System::Drawing::Size(912, 494);
00460             this-&gt;Controls-&gt;Add(this-&gt;groupBox3);
00461             this-&gt;Controls-&gt;Add(this-&gt;groupBox2);
00462             this-&gt;Controls-&gt;Add(this-&gt;groupBox1);
00463             this-&gt;Icon = (__try_cast&lt;System::Drawing::Icon *  &gt;(resources-&gt;GetObject(S<span class="stringliteral">"$this.Icon"</span>)));
00464             this-&gt;Name = S<span class="stringliteral">"myWindow"</span>;
00465             this-&gt;Text = S<span class="stringliteral">"Image Viewer"</span>;
00466             this-&gt;panel1-&gt;ResumeLayout(<span class="keyword">false</span>);
00467             this-&gt;groupBox1-&gt;ResumeLayout(<span class="keyword">false</span>);
00468             this-&gt;groupBox2-&gt;ResumeLayout(<span class="keyword">false</span>);
00469             this-&gt;groupBox3-&gt;ResumeLayout(<span class="keyword">false</span>);
00470             this-&gt;ResumeLayout(<span class="keyword">false</span>);
00471 
00472         }       
00473 
00474 
00475 
00476     
00477 <span class="comment">//  private: void separateChar();</span>
00478 <span class="comment">//` private: void separate();</span>
00479 
00480     <span class="keyword">private</span>: System::Void exitButton_Click(System::Object *  sender, System::EventArgs *  e)
00481              {
00482                  this-&gt;Hide();
00483              }
00484 
00485 
00486 <span class="keyword">private</span>: <span class="keywordtype">void</span> LoadFromFile()
00487          {
00488             System::IO::StreamReader* sr = System::IO::StreamReader::Null;
00489             System::String* tempStr;
00490             System::String* charStr;
00491             System::String* unicodeStr;
00492             <span class="keywordtype">int</span> index;
00493 
00494             <span class="keywordflow">try</span>
00495             {
00496                 this-&gt;slForCharacters = <span class="keyword">new</span> System::Collections::SortedList();
00497                 <span class="comment">// read the characters and store</span>
00498                 sr = <span class="keyword">new</span> System::IO::StreamReader(this-&gt;characterDBPath);
00499                 tempStr = sr-&gt;ReadLine();
00500                 <span class="keywordflow">while</span> (tempStr-&gt;Length!=0)
00501                 {
00502                     index = tempStr-&gt;IndexOf(<span class="stringliteral">" "</span>);
00503                     charStr = tempStr-&gt;Substring(0,index);
00504                     unicodeStr = tempStr-&gt;Substring(index+1);
00505                     slForCharacters-&gt;Add(charStr,unicodeStr);
00506                     tempStr = sr-&gt;ReadLine();
00507                 }
00508                 sr-&gt;Close();
00509             }
00510             <span class="keywordflow">catch</span>(System::Exception* ex)
00511             {
00512                 System::String* errorString1=<span class="stringliteral">""</span>;
00513                 errorString1 = ex-&gt;Message-&gt;ToString();
00514                 errorString1 = errorString1-&gt;Concat(<span class="stringliteral">"Database file access error \n\nThe system generated the following error:\n"</span>,errorString1);
00515                 System::Windows::Forms::MessageBox::Show( errorString1,<span class="stringliteral">"Error"</span>);
00516                 exit(0);
00517             }
00518          }<span class="comment">//End LoadFromFile</span>
00519 
00520     <span class="keyword">private</span>: <span class="keywordtype">void</span> makeBinary()
00521              {
00522                  <span class="keywordflow">if</span>(this-&gt;ImageLoaded)
00523                  {
00524                 
00525                     <span class="keywordflow">try</span>{
00526                      <span class="comment">// set the cursor to wait.... </span>
00527                         this-&gt;Cursor = System::Windows::Forms::Cursors::WaitCursor;
00528 
00529                      
00530                      <span class="comment">// calculating Thresholed Value for binary image                    </span>
00531                         ThresholedValue* ts = <span class="keyword">new</span> ThresholedValue(im);
00532                         <span class="keywordtype">float</span> fLevel = ts-&gt;GetThresholed();
00533                         intLevel = int(fLevel*255);
00534                     
00535                      
00536                      
00537                      <span class="comment">// getting an binary array of                   </span>
00538                         rgbConvert* rgbC = <span class="keyword">new</span> rgbConvert(im);
00539                         BArray = rgbC-&gt;GetBinaryArray(200);
00540                         ImgArray = rgbC-&gt;GetImageArray( );
00541                         
00542                      <span class="comment">// Showing the binary image</span>
00543                         this-&gt;BinaryImage = rgbC-&gt;GetBinaryImage();
00544                         this-&gt;pictureBox_myWindow-&gt;Image = this-&gt;BinaryImage;
00545                         
00546                      <span class="comment">// set the cursor to Default.... </span>
00547                         this-&gt;Cursor = System::Windows::Forms::Cursors::Default;
00548                         <span class="comment">//System::Windows::Forms::MessageBox::Show(this-&gt;intLevel.ToString()/*fLevel.ToString()*/,"Threshold Value");</span>
00549                         this-&gt;BinaryDone=<span class="keyword">true</span>;
00550                     }
00551                  <span class="keywordflow">catch</span>(System::Exception* ex)
00552                     {
00553                     System::Windows::Forms::MessageBox::Show(ex-&gt;Message-&gt;ToString(),<span class="stringliteral">"Failed to Binarize the Image!!"</span>,System::Windows::Forms::MessageBoxButtons::OK,System::Windows::Forms::MessageBoxIcon::Error);
00554                     this-&gt;Update();
00555                     }
00556                  this-&gt;Update();
00557                  }
00558     }<span class="comment">// end of function MakeBinary</span>
00559 
00560          <span class="keyword">private</span>: <span class="keywordtype">void</span> separateChar()
00561                  {
00562                      <span class="keywordtype">float</span> myPenSum=0;
00563                      <span class="keywordtype">int</span> myPenCount = 0;
00564                      
00565                      Pen* p=<span class="keyword">new</span> Pen(Color::Blue,1);
00566 
00567                      
00568                                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;this-&gt;numberOfLines;i++)
00569                                     {
00570                                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;this-&gt;Lines[i].getTotalWord();j++)
00571                                             {
00572                                                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0;k&lt;this-&gt;Lines[i].Words[j].getTotalUnit();k++)
00573                                                     {
00574                                                         <span class="keywordtype">int</span> x1=this-&gt;Lines[i].Words[j].Units[k].getStartColumn();
00575                                                         <span class="keywordtype">int</span> x2=this-&gt;Lines[i].Words[j].Units[k].getEndColumn();
00576                                                         <span class="keywordtype">int</span> y1=this-&gt;Lines[i].getStartRow();
00577                                                         <span class="keywordtype">int</span> y2=this-&gt;Lines[i].getEndRow();
00578                                                          myPenSum+=(y2-y1)/(x2-x1);
00579                                                          myPenCount++;
00580                                                          <span class="comment">//System::Windows::Forms::MessageBox::Show((myPenSum/myPenCount).ToString(),"Transformation Factor");</span>
00581                                                         g-&gt;DrawLine(p,x1,y1,x1,y2);
00582                                                         g-&gt;DrawLine(p,x2,y1,x2,y2);
00583                                                     }
00584                                             }
00585                                     }
00586 
00587                  }<span class="comment">//End SeparateChar</span>
00588     <span class="keyword">private</span>: <span class="keywordtype">void</span> separate()
00589                  {
00590                      this-&gt;tmpBArray=<span class="keyword">new</span> <span class="keywordtype">bool</span>*[im-&gt;Height]; 
00591                       
00592                      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;im-&gt;Height;i++)
00593                      {
00594                          this-&gt;tmpBArray[i]=<span class="keyword">new</span> <span class="keywordtype">bool</span>[im-&gt;Width];
00595                          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;im-&gt;Width;j++)
00596                          {
00597                              this-&gt;tmpBArray[i][j]=this-&gt;BArray[i][j];
00598                          }
00599 
00600                      }
00601                      <span class="keywordflow">if</span>(this-&gt;BinaryDone==<span class="keyword">true</span>) <span class="comment">//If binarization is done</span>
00602                         {
00603 
00604                             <span class="keywordflow">if</span>(this-&gt;SeparateDone==<span class="keyword">false</span>)
00605                             {
00606                             Separate* sp=<span class="keyword">new</span> Separate(im,BArray,g);
00607                             sp-&gt;LineSeparate();                     <span class="comment">//Separate Lines from the image</span>
00608 
00609                             this-&gt;numberOfLines=sp-&gt;getNumberOfLines(); <span class="comment">//Get Number of Lines</span>
00610                             this-&gt;Lines=sp-&gt;getLines();         <span class="comment">//Get Lines</span>
00611                             this-&gt;SeparateDone=<span class="keyword">true</span>;
00612                             this-&gt;separateChar();               <span class="comment">//separate Characters                   </span>
00613                             }
00614 
00615                             <span class="keywordflow">else</span>
00616                             {
00617                                 this-&gt;separateChar();           <span class="comment">//separate Characters</span>
00618                             }
00619 
00620                             
00621                         }
00622                      
00623                     this-&gt;Update();
00624                  }<span class="comment">//End Separate</span>
00625     <span class="keyword">private</span>: System::Void nextButton_Click(System::Object *  sender, System::EventArgs *  e)
00626          {
00627              <span class="keywordflow">if</span>(charno&lt;this-&gt;LineInfo[lineno].Words[wordno].getTotalUnit()-1)
00628                  {
00629                      this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">"\n--------within first if ---total units ----------"</span>);
00630                      this-&gt;myRTB-&gt;AppendText(this-&gt;LineInfo[lineno].Words[wordno].getTotalUnit().ToString());
00631 
00632                      this-&gt;charno++;
00633                  
00634 
00635                  }
00636                  <span class="keywordflow">else</span>
00637                  {
00638                      <span class="comment">//this-&gt;charno=0;</span>
00639                      <span class="keywordflow">if</span>(wordno&lt; this-&gt;LineInfo[lineno].getTotalWord()-1)
00640                      {
00641                          this-&gt;wordno++;
00642                          this-&gt;charno=0;
00643                          this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">"\n else if -----------total units ----------"</span>);
00644                          this-&gt;myRTB-&gt;AppendText(this-&gt;LineInfo[lineno].Words[wordno].getTotalUnit().ToString());
00645                          
00646                             }
00647 
00648 
00649                      <span class="keywordflow">else</span>
00650                      {
00651                          this-&gt;wordno=0;
00652                          this-&gt;charno=0;
00653                          <span class="keywordflow">if</span>(lineno&lt;this-&gt;lineCount-1)
00654                          {
00655                              this-&gt;lineno++;
00656                              this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">"------else else if -----total units ----------"</span>);
00657                              this-&gt;myRTB-&gt;AppendText(this-&gt;LineInfo[lineno].Words[wordno].getTotalUnit().ToString());
00658                              
00659                                     }
00660                          <span class="keywordflow">else</span>
00661                          {
00662                              this-&gt;lineno=0;
00663                              this-&gt;wordno=0;
00664                              this-&gt;charno=0;
00665                              this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">"------else else else -----total units ----------"</span>);
00666                              this-&gt;myRTB-&gt;AppendText(this-&gt;LineInfo[lineno].Words[wordno].getTotalUnit().ToString());
00667                             
00668                          }
00669                      }
00670                  }
00671                  this-&gt;display(this-&gt;lineno,this-&gt;wordno,this-&gt;charno);
00672                  this-&gt;Update();
00673 
00674 
00675                  this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">"\n x1:"</span>);
00676                  this-&gt;myRTB-&gt;AppendText(x1.ToString());
00677                  this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">" x2:"</span>);
00678                  this-&gt;myRTB-&gt;AppendText(x2.ToString());
00679                  this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">" y1:"</span>);
00680                  this-&gt;myRTB-&gt;AppendText(y1.ToString());
00681                  this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">" y2:"</span>);
00682                  this-&gt;myRTB-&gt;AppendText(y2.ToString());
00683                  this-&gt;myRTB-&gt;AppendText(<span class="stringliteral">" Charno:"</span>);
00684                  this-&gt;myRTB-&gt;AppendText(this-&gt;charno.ToString());
00685                  x1=this-&gt;LineInfo[lineno].Words[wordno].Units[charno].getStartColumn(); <span class="comment">//Equivalent to :: left_x</span>
00686                  x2=this-&gt;LineInfo[lineno].Words[wordno].Units[charno].getEndColumn();  <span class="comment">//Equivalent to :: right_x</span>
00687                  y1=this-&gt;LineInfo[lineno].getStartRow();       <span class="comment">//Equivalent to :: top_y</span>
00688                  y2=this-&gt;LineInfo[lineno].getEndRow(); 
00689                 <span class="comment">// singleRecognize(x1,x2,y1,y2,1) ;</span>
00690 
00691                  <span class="comment">//Cuzz charno starts from 0, we need to increment charno by 1, before recognizing</span>
00692                 <span class="comment">// singleRecognize(x1,x2,y1,y2,charno) ;</span>
00693                 
00694                  
00695                  
00696              
00697          }
00698     <span class="keyword">public</span>: 
00699         <span class="keywordtype">void</span> defineVar(<span class="keywordtype">int</span>** ImgArray,<span class="keywordtype">bool</span>** BArray,Line* Lines,<span class="keywordtype">int</span> numberOfLines)
00700             {
00701                 this-&gt;ImageArray=ImgArray;
00702                 this-&gt;BinArray=BArray;
00703                 this-&gt;LineInfo=Lines;
00704                 this-&gt;lineCount=numberOfLines;
00705                 this-&gt;display(this-&gt;lineno,this-&gt;wordno,this-&gt;charno);
00706                 
00707             }
00708     <span class="keywordtype">void</span> display(<span class="keywordtype">int</span> lineno,<span class="keywordtype">int</span> wordno,<span class="keywordtype">int</span> charno)
00709         {
00710             x1=this-&gt;LineInfo[lineno].Words[wordno].Units[charno].getStartColumn(); <span class="comment">//Equivalent to :: left_x</span>
00711             x2=this-&gt;LineInfo[lineno].Words[wordno].Units[charno].getEndColumn();   <span class="comment">//Equivalent to :: right_x</span>
00712             y1=this-&gt;LineInfo[lineno].getStartRow();        <span class="comment">//Equivalent to :: top_y</span>
00713             y2=this-&gt;LineInfo[lineno].getEndRow();           <span class="comment">//Equivalent to :: bottom_y</span>
00714             
00715             <span class="keywordtype">int</span> xsize=x2-x1+1;
00716             <span class="keywordtype">int</span> ysize=y2-y1+1;
00717              
00718             this-&gt;cropImage=<span class="keyword">new</span> Bitmap(xsize,ysize,Imaging::PixelFormat::Format24bppRgb);
00719             
00720             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=y1;i&lt;=y2;i++)<span class="comment">//traverse throughy</span>
00721             {
00722                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=x1;j&lt;=x2;j++)<span class="comment">//traverse through x</span>
00723                 {
00724                     <span class="keywordflow">if</span>(this-&gt;BinArray[i][j])
00725                     {
00726                          
00727                         this-&gt;cropImage-&gt;SetPixel(j-x1,i-y1,Color::White);
00728                     }
00729                     <span class="keywordflow">else</span>
00730                     {
00731                         this-&gt;cropImage-&gt;SetPixel(j-x1,i-y1,Color::Black);
00732                     }
00733                 }
00734             }
00735             this-&gt;pictureBoxSmall-&gt;Image=cropImage;
00736             this-&gt;smallHeightLabel-&gt;Text = this-&gt;cropImage-&gt;Height.ToString();
00737             this-&gt;smallWidthLabel-&gt;Text = this-&gt;cropImage-&gt;Width.ToString();
00738             <span class="comment">//this-&gt;singleRecognize(x1,x2,y1,y2,0);</span>
00739         }
00740     
00741     <span class="keyword">private</span>: <span class="keywordtype">void</span> singleRecognize(<span class="keywordtype">int</span> left_x,<span class="keywordtype">int</span> right_x,<span class="keywordtype">int</span> top_y,<span class="keywordtype">int</span> bottom_y,<span class="keywordtype">int</span> charno){
00742                  <span class="comment">//Assumption: int left_x  :::word start</span>
00743                  <span class="comment">//int right_x              ::: word end</span>
00744                  <span class="comment">//int top_y ~ equivalent to :: int top_x :::Line start</span>
00745                  <span class="comment">//int bottom_y ~ equivalent to :: int bottom_y :::Line end</span>
00746             
00747             System::String* wordToRec;
00748             RecognitionProcess* rp = <span class="keyword">new</span> RecognitionProcess(this-&gt;applicationPath,this-&gt;ImgArray);
00749             
00750             System::String* dirOfRecFile = rp-&gt;recognitionTempFileDir;
00751             this-&gt;slModelTranscription = rp-&gt;LoadModelTranscriptions(this-&gt;modelTrainDBPath);
00752             rp-&gt;SetImageBoundary(left_x,right_x,top_y,bottom_y);
00753             <span class="keywordtype">int</span> totalUnit =charno;
00754             
00755             <span class="comment">//rp-&gt;PrepareWordData(wordToRec);</span>
00756             <span class="comment">//Assumption : totalunit for single recognize is 1</span>
00757 
00758                 wordToRec = wordToRec-&gt;Concat(dirOfRecFile,totalUnit.ToString(),<span class="stringliteral">".txt"</span>);    
00759             
00760                 <span class="keywordflow">if</span>(this-&gt;SeparateDone){         
00761                 rp-&gt;PrepareWordData(wordToRec);
00762                 }
00763                 <span class="keywordflow">else</span>{
00764                     System::Windows::Forms::MessageBox::Show(<span class="stringliteral">"The words are not separated. \n Cannot Process for recognition"</span>,<span class="stringliteral">"Error"</span>);
00765                     exit(0);
00766                 }
00767 
00768                 <span class="keywordflow">try</span>
00769                 {
00770                     System::IO::StreamWriter* sw = System::IO::File::AppendText(rp-&gt;scriptFilePath);    
00771                     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1;i&lt;=totalUnit;i++)   
00772                     {
00773                         System::String* tmp=tmp-&gt;Concat((String*)<span class="stringliteral">"\""</span>,dirOfRecFile,i.ToString(),(String*)<span class="stringliteral">".txt"</span>,(String*)<span class="stringliteral">"\""</span>);
00774                         sw-&gt;WriteLine(tmp);
00775                         sw-&gt;Flush();
00776                     }
00777                     sw-&gt;Close();
00778                 }
00779                 <span class="keywordflow">catch</span>(System::Exception* ex)
00780                 {
00781                     System::Windows::Forms::MessageBox::Show(ex-&gt;Message-&gt;ToString(),<span class="stringliteral">"Failed to prepare the script file!!"</span>,System::Windows::Forms::MessageBoxButtons::OK,System::Windows::Forms::MessageBoxIcon::Error);
00782                     exit(0);
00783                 }
00784             
00785                 this-&gt;alModelRec = rp-&gt;RecognizeByHTK();
00786                 this-&gt;ProvideOutput();
00787                 System::IO::File::Delete(rp-&gt;scriptFilePath);
00788                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1;i&lt;=totalUnit;i++)   
00789                 {
00790                     System::String* tmp=tmp-&gt;Concat(dirOfRecFile,i.ToString(),<span class="stringliteral">".txt"</span>);
00791                     System::IO::File::Delete(tmp);
00792                 }
00793 
00794             
00795              
00796 
00797 }    <span class="comment">//End singleRecognize</span>
00798     
00799     <span class="keyword">private</span>: <span class="keywordtype">void</span> Recognize()
00800         {        
00801                         RecognitionProcess* rp = <span class="keyword">new</span> RecognitionProcess(this-&gt;applicationPath,this-&gt;ImgArray);
00802                         <span class="comment">// load the transcription of the models</span>
00803                         this-&gt;slModelTranscription = rp-&gt;LoadModelTranscriptions(this-&gt;modelTrainDBPath);
00804                         <span class="keywordtype">int</span> lineCount = this-&gt;numberOfLines;
00805                         <span class="keywordtype">int</span> wordCount = 0;
00806                         <span class="keywordtype">int</span> totalUnit = 0;
00807                         <span class="keywordtype">int</span> unitCount = 0;
00808                         <span class="keywordtype">int</span> left_x,right_x,top_y,bottom_y;
00809                         System::String* wordToRec;
00810                         System::String* dirOfRecFile = rp-&gt;recognitionTempFileDir;
00811                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;lineCount;i++)
00812                         {                
00813                             top_y = this-&gt;Lines[i].getStartRow();<span class="comment">//line start</span>
00814                             bottom_y = this-&gt;Lines[i].getEndRow();<span class="comment">//line end</span>
00815 
00816                             wordCount = this-&gt;Lines[i].getTotalWord();
00817                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;wordCount;j++)
00818                             {                    
00819                                 unitCount = this-&gt;Lines[i].Words[j].getTotalUnit();                  
00820                                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;unitCount; k++)
00821                                 {
00822                                     left_x = this-&gt;Lines[i].Words[j].Units[k].getStartColumn();<span class="comment">//word start</span>
00823                                     right_x = this-&gt;Lines[i].Words[j].Units[k].getEndColumn();<span class="comment">//word end</span>
00824 
00825                                     <span class="comment">// setting the actual image boundary</span>
00826                                     rp-&gt;SetImageBoundary(left_x,right_x,top_y,bottom_y);
00827                                     totalUnit++;
00828                                     wordToRec = wordToRec-&gt;Concat(dirOfRecFile,totalUnit.ToString(),<span class="stringliteral">".txt"</span>);    
00829                                     rp-&gt;PrepareWordData(wordToRec);
00830                                 } 
00831                             }<span class="comment">//wordcount</span>
00832                         }
00833                         <span class="comment">// preparing the script file to be recognized</span>
00834                         <span class="keywordflow">try</span>
00835                         {
00836                             System::IO::StreamWriter* sw = System::IO::File::AppendText(rp-&gt;scriptFilePath);    
00837                             <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1;i&lt;=totalUnit;i++)   
00838                             {
00839                                 System::String* tmp=tmp-&gt;Concat((String*)<span class="stringliteral">"\""</span>,dirOfRecFile,i.ToString(),(String*)<span class="stringliteral">".txt"</span>,(String*)<span class="stringliteral">"\""</span>);
00840                                 sw-&gt;WriteLine(tmp);
00841                                 sw-&gt;Flush();
00842                             }
00843                             sw-&gt;Close();
00844                         }
00845                         <span class="keywordflow">catch</span>(System::Exception* ex)
00846                         {
00847                             System::Windows::Forms::MessageBox::Show(ex-&gt;Message-&gt;ToString(),<span class="stringliteral">"Failed to prepare the script file!!"</span>,System::Windows::Forms::MessageBoxButtons::OK,System::Windows::Forms::MessageBoxIcon::Error);
00848                             exit(0);
00849                         }
00850                         this-&gt;alModelRec = rp-&gt;RecognizeByHTK();
00851                         this-&gt;ProvideOutput();
00852                         System::IO::File::Delete(rp-&gt;scriptFilePath);
00853                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1;i&lt;=totalUnit;i++)   
00854                         {
00855                             System::String* tmp=tmp-&gt;Concat(dirOfRecFile,i.ToString(),<span class="stringliteral">".txt"</span>);
00856                             System::IO::File::Delete(tmp);
00857                         }
00858         }<span class="comment">//End Function Recognize</span>
00859     <span class="keyword">private</span>: <span class="keywordtype">void</span> ProvideOutput()
00860          {
00861             System::String* tempStr = <span class="stringliteral">""</span>;
00862             System::String* text = <span class="stringliteral">""</span>;
00863             System::Collections::ArrayList* tempAl; <span class="comment">// temporary working array list</span>
00864             System::String* ucodeStr;   
00865             <span class="keywordflow">try</span>
00866             {   
00867                 <span class="keywordtype">int</span> index = 0;
00868                 <span class="keywordtype">int</span> ind = 0;
00869                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; this-&gt;numberOfLines; i++  )
00870                 {
00871                     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; this-&gt;Lines[i].getTotalWord(); j++)
00872                     {
00873                         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; this-&gt;Lines[i].Words[j].getTotalUnit(); k++)
00874                         {
00875                             <span class="keywordflow">if</span> ( ind &lt; this-&gt;alModelRec-&gt;Count)
00876                             {
00877                                 ucodeStr = <span class="stringliteral">""</span>;
00878                                     
00879                             System::Collections::IEnumerator* ENum;
00880                             ENum=this-&gt;alModelRec-&gt;GetEnumerator();
00881                             System::String* tempStr=<span class="stringliteral">""</span>;
00882                             <span class="keywordtype">int</span> tempCount=0;
00883                             <span class="keywordflow">while</span>(ENum-&gt;MoveNext())
00884                                 {
00885                                     <span class="keywordflow">if</span>(ind==tempCount)
00886                                     {
00887                                     tempStr=ENum-&gt;Current-&gt;ToString();
00888                                     <span class="keywordflow">break</span>;
00889                                     }
00890                                     tempCount++;
00891                                 }
00892                                 index = this-&gt;slModelTranscription-&gt;IndexOfKey(tempStr);
00893                                 ind++;
00894                                 tempAl = (System::Collections::ArrayList*)slModelTranscription-&gt;GetByIndex(index);
00895                                 System::Collections::IEnumerator* tempNum=tempAl-&gt;GetEnumerator();
00896                                 <span class="keywordflow">while</span>(tempNum-&gt;MoveNext())
00897                                 {
00898                                     tempStr = (String*)tempNum-&gt;Current;
00899                                     ucodeStr = ucodeStr-&gt;Concat(ucodeStr,slForCharacters-&gt;GetKey(slForCharacters-&gt;IndexOfValue(tempStr)));
00900                                 }
00901                                                 
00902                                 text = text-&gt;Concat(text,ucodeStr);
00903                             }<span class="comment">// end if</span>
00904                         }
00905                         text = text-&gt;Concat(text,(String*)<span class="stringliteral">" "</span>);                     
00906                     }
00907                     text = text-&gt;Concat(text,(String*)<span class="stringliteral">"\n"</span>);
00908                 }
00909             }
00910             <span class="keywordflow">catch</span>(System::Exception* ex)
00911             {
00912                 System::Windows::Forms::MessageBox::Show(ex-&gt;Message-&gt;ToString(),<span class="stringliteral">"Failed to provide the output!!"</span>,System::Windows::Forms::MessageBoxButtons::OK,System::Windows::Forms::MessageBoxIcon::Error);
00913                 exit(0);
00914             }
00915          
00916             <a class="code" href="classOCR_1_1RecognitionForm.html">OCR::RecognitionForm</a>* rw=<span class="keyword">new</span> <a class="code" href="classOCR_1_1RecognitionForm.html">OCR::RecognitionForm</a>();
00917             rw-&gt;<a class="code" href="classOCR_1_1RecognitionForm.html#a1">showText</a>(text);
00918             rw-&gt;ShowDialog();
00919          }<span class="comment">//End ProvideOutput</span>
00920 
00921 <span class="keyword">private</span>: System::Void myWindowSeparateButton_Click(System::Object *  sender, System::EventArgs *  e)
00922          {
00923              this-&gt;makeBinary();
00924              this-&gt;separate();
00925          }<span class="comment">//End myWindowSeparateButton_Click</span>
00926 
00927 <span class="keyword">private</span>: System::Void myWindowRecognizeButton_Click(System::Object *  sender, System::EventArgs *  e)
00928          {
00929              this-&gt;Recognize();
00930          }<span class="comment">//End myWindowRecognizeButton_Click</span>
00931 
00932 <span class="keyword">private</span>: System::Void singleRecog_Click(System::Object *  sender, System::EventArgs *  e)
00933          {
00934              singleRecognize(x1,x2,y1,y2,1) ;
00935          }
00936 
00937 <span class="keyword">private</span>: System::Void saveButton_ImageViewer_Form_Click(System::Object *  sender, System::EventArgs *  e)
00938          {
00939             <span class="comment">/*</span>
00940 <span class="comment"></span>
00941 <span class="comment">            This method is used to save the image file after certain image processing portion is complete.</span>
00942 <span class="comment">            In case we need the file in future.</span>
00943 <span class="comment"></span>
00944 <span class="comment">            */</span>
00945                     saveFileDialog_Image_Viewer-&gt;Filter= <span class="stringliteral">"PNG files (*.jpg)|*.jpg|PNG files (*.png)|*.png|All valid files (*.jpg/*.png)|*.jpg/*.png"</span> ;
00946                     saveFileDialog_Image_Viewer-&gt;FilterIndex = 1 ;
00947                     saveFileDialog_Image_Viewer-&gt;RestoreDirectory = <span class="keyword">true</span> ;
00948 
00949                     System::Windows::Forms::DialogResult d = this-&gt;saveFileDialog_Image_Viewer-&gt;ShowDialog();
00950                         <span class="keywordflow">if</span> (d == System::Windows::Forms::DialogResult::OK)               
00951                             {            
00952                             <span class="comment">// creating a bitmap</span>
00953                             Bitmap* save;
00954                             save=<span class="keyword">new</span> Bitmap(this-&gt;pictureBoxSmall-&gt;Image);
00955                             save-&gt;Save(saveFileDialog_Image_Viewer-&gt;FileName);
00956                             
00957                             }
00958         
00959          }
00960 
00961 };
00962 }
</pre></div><hr><address style="align: right;"><small>
Generated on Tue Jul 1 18:54:50 2008 for OCR by <a href="http://www.mpp.org.np">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a>    </small></address>
</body>
</html>
